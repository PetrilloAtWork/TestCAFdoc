<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.12.0"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>CAF format: Rendering and publishing icaruscode documentation</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<script type="text/javascript" src="clipboard.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="cookie.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
window.MathJax = {
  options: {
    ignoreHtmlClass: 'tex2jax_ignore',
    processHtmlClass: 'tex2jax_process'
  },
  loader: {
    load: ['[tex]/TeX/AMSmath','[tex]/TeX/AMSsymbols']
  },
  tex: {
    macros: {},
    packages: ['base','configmacros','TeX/AMSmath','TeX/AMSsymbols']
  }
};
</script>
<script type="text/javascript" id="MathJax-script" async="async" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectalign">
   <div id="projectname">CAF format<span id="projectnumber">&#160;${SBNANAOBJ_VERSION}</span>
   </div>
   <div id="projectbrief">Simulation, reconstruction and analysis software for the ICARUS experiment.</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.12.0 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search/",'.html');
/* @license-end */
</script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() { codefold.init(0); });
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search',false);
  $(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function(){ initResizable(false); });
/* @license-end */
</script>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

</div><!-- top -->
<div id="doc-content">
<div><div class="header">
  <div class="headertitle"><div class="title">Rendering and publishing icaruscode documentation</div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p><a class="anchor" id="md_icaruscode_2doc_2scripts_2GenerateDocumentation"></a></p>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadNone">Title:   </th><th class="markdownTableHeadNone">Rendering and publishing <code>icaruscode</code> documentation    </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">Type:   </td><td class="markdownTableBodyNone">Technical documentation    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">Author:   </td><td class="markdownTableBodyNone">Gianluca Petrillo (<a href="mailto:petrillo@slac.stanford.edu">petrillo@slac.stanford.edu</a>)    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">Created on:   </td><td class="markdownTableBodyNone">April 23, 2020    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">Version:   </td><td class="markdownTableBodyNone">1.1   </td></tr>
</table>
<p>This document describes a procedure to render the documentation embedded in the <code>icaruscode</code> source code, in Doxygen format, and to publish the result in the ICARUS documentation web page.</p>
<h2>Format of this document</h2>
<p>This file (<code>GenerateDocumentation.md</code>) is written in a dialect of <a href="https://daringfireball.net/projects/markdown">Markdown</a> format that is compatible with <a href="https://pandoc.org/MANUAL.html"><code>pandoc</code></a> and with Doxygen. The format is designed to be readable as plain text: the reader will find all the links to external resources at the end of the document. The program <code>pandoc</code> allows to render this file in other formats. For example, to render it into Portable Document Format: </p><pre class="fragment">pandoc --toc -o GenerateDocumentation.pdf GenerateDocumentation.md
</pre><p>and to render it into HyperText Markup Language format: </p><pre class="fragment">pandoc --toc -o GenerateDocumentation.html GenerateDocumentation.md
</pre><h1>Outline of the procedure</h1>
<p>The documentation written in Doxygen format across <code>icaruscode</code> source files can be rendered by the <code>doxygen</code> program in one of several formats. We render it in HTML format, and then copy the result into an area ("Software") which is served by Fermilab web server under <a href="http://icarus-exp.fnal.gov">http://icarus-exp.fnal.gov</a>.</p>
<p>While the procedure is mostly automated, it is requested that an operator pushes through all the steps:</p>
<ol type="1">
<li>rendering of the documentation</li>
<li>transfer of the rendered content to the web server storage area</li>
<li>update of web page linking to the available documentation</li>
</ol>
<p>Each of these steps is carried out with one script.</p>
<h2>Rendering of the documentation</h2>
<p>The rendering is the more complex part of the procedure, and also the most versatile. The script to run this part is <code>updateLocalDocumentation.sh</code>. This script can be found in <code>icaruscode</code> GIT repository under <code>doc/scripts</code> directory. In order to successfully run it, the additional library scripts <code>settings.sh</code> and <code>utilities.sh</code> must also be in the same directory as the main script. In addition, <code>experiment_settings.sh</code> overriding the general settings is also parsed. There are two possibilities:</p>
<ul>
<li>clone the GIT repository altogether, and find the scripts in <code>icaruscode/doc/scripts</code>;</li>
<li>download the three (plus one) scripts from anywhere.</li>
</ul>
<p>The script, when running, will clone the repository anyway, so the recommended approach is to clone it first, e.g.: </p><pre class="fragment">git clone https://github.com/SBNSoftware/icaruscode.git
icaruscode/doc/scripts/updateLocalDocumentation.sh
</pre><p>Note that the script <em>must</em> be executed from outside the <code>icaruscode</code> GIT repository, like in the example above.</p>
<p>Normally this will clone or <em>update</em> the repository, and run Doxygen on it. Note that <b>"update"</b>: the script <code>updateLocalDocumentation.sh</code> <b>does</b> mess up with the GIT repository, and while there is some provision not to lose data, if that repository has anything valuable it should be backed up or pushed before running.</p>
<p>The script will use a template Doxygen configuration file (by default it's in <code>icaruscode/doc</code>), replace some parameters dynamically and then produce HTML output into a directory that is configured in the Doxygen file (usually <code>html</code>). A Doxygen "tag" file is also generated and kept in the output directory. It also copies the configuration file in that output directory, and sets a small text file <code>meta/doxygen</code> with metadata about the documentation generation. A log file is created in the <code>log</code> directory with the full Doxygen output on screen. If run again, it will attempt to update the GIT repository and then regenerate the documentation, overwriting the previous one. Note that there have been instances where part of the documentation would not be updated; in that case, the option <code>--clean</code> will remove the previous rendering.</p>
<p>As a special mode, the script can be instructed to check out a specific branch for the documentation, or even to use whatever is already there (option <code>--currentbranch</code>), in which case the repository is not updated. These options have been tested much less than the standard running mode, so special care should be taken when running.</p>
<p>At this point, opening the file <code>html/index.html</code> with a local browser will access the documentation. To publish it in the standard ICARUS web page, the two following steps are now needed.</p>
<h2>Copying the documentation into the standard ICARUS web page</h2>
<p>The copy of the documentation rendered in the previous step into the standard location for the ICARUS web page is performed via <code>publish.sh</code> script. By this time, the script should be available in the same directory as <code>updateLocalDocumentation.sh</code>, in <code>icaruscode/doc/scripts</code> of the cloned GIT repository.</p>
<p>The data in the web site is organized as follow: </p><pre class="fragment">icaruscode
  v08_50_00
    index.html
    meta/doxygen
    ...
  v08_50_01
    index.html
    meta/doxygen
    ...
  latest -&gt; v08_50_01
</pre><p>When the script is run, a new directory is added with as name the version of the code being documented, and the symbolic link <code>latest</code> is updated to point to that version (which, strictly speaking, <em>is</em> the latest being added).</p>
<p>For this operation to succeed, the user must have permissions to write into the web content directory; and before that, the node where this script is ran must have POSIX (e.g. NFS) access to that directory. Enabling these is matter of Fermilab service desk requests.</p>
<p>If the directory already exists, the script will refuse to proceed. This is intentional, to prevent a potentially complex script from unintentionally deleting information on the web site in case of errors or bugs.</p>
<p>At this point, the documentation is published in the web but it is not linked yet in the index page of the various versions. That is the purpose of the last step.</p>
<h2>Updating the list of documented versions</h2>
<p>The HTML page with the list of available versions is generated anew every time from a HTML template, by the script <code>updateVersionList.sh</code>, sibling of the other two in the same directory. The page generated in this way is currently served as <a href="https://icarus-exp.fnal.gov/at_work/software/doc/icaruscode/versionlist.html">https://icarus-exp.fnal.gov/at_work/software/doc/icaruscode/versionlist.html</a></p>
<p>This script also requires POSIX access to the web storage area. The template used for the page is "hand-written" copying some boilerplate HTML from other pages in the ICARUS web site. There are probably smarter ways to do that, although I am not sure Fermilab is aware of them.</p>
<h2>Configuration of the scripts</h2>
<p>The script <code>updateLocalDocumentation.sh</code> supports a few command line options (run with <code>--help</code> to read about them). The other two scripts currently accept no option at all. All three scripts share some configuration settings, and these settings are stored in a file aptly called <code>settings.sh</code>.</p>
<p>Some parameters as the path to the web storage area, the name of the experiment, the branch to check out by default, etc., are encoded in the file.</p>
<h1>TL;DR</h1>
<pre class="fragment">[[ -d 'icaruscode' ]] || git clone https://github.com/SBNSoftware/icaruscode.git
bash icaruscode/doc/scripts/updateLocalDocumentation.sh
bash icaruscode/doc/scripts/publish.sh
bash icaruscode/doc/scripts/updateVersionList.sh
</pre><h1>Change log</h1>
<p>Version 1.0 (April 23, 2020, <a href="mailto:petrillo@slac.stanford.edu">petrillo@slac.stanford.edu</a>) : original version</p>
<p>Version 1.1 (April 12, 2021, <a href="mailto:petrillo@slac.stanford.edu">petrillo@slac.stanford.edu</a>) : updated GIT repository (GitHub) and general refresh. </p>
</div></div><!-- contents -->
</div><!-- PageDoc -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by&#160;<a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.12.0
</small></address>
</div><!-- doc-content -->
</body>
</html>
